(()=>{const e=48.5701,t=2.6324;function n(e,t,n,o){const r=6371,a=(n-e)*Math.PI/180,i=(o-t)*Math.PI/180,l=Math.sin(a/2)**2+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(i/2)**2;return 2*r*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}async function o(e){const t="https://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(e)+"&countrycodes=fr",n=await fetch(t),o=await n.json();if(!o.length)throw 0;return{lat:+o[0].lat,lon:+o[0].lon}}document.getElementById("btn").addEventListener("click",async()=>{const r=document.getElementById("adresse").value,a=document.getElementById("type").value,i=parseInt(document.getElementById("n").value),l=document.getElementById("resultat");if(!r||i<=0)return l.innerHTML="Veuillez saisir une adresse valide.";l.innerHTML="Calcul en cours...";try{const s=await o(r),c=1.3*n(e,t,s.lat,s.lon);let d;"A"===a?d=i<=2?900+3.5*c+250*i:1200+3.5*c+200*i:d=i<=2?500+3.5*c+120*i:800+3.5*c+110*i,l.innerHTML="Distance estimée : <strong>"+c.toFixed(1)+" km</strong><br>Prix estimatif : <strong>"+d.toFixed(0)+" € HT</strong>"}catch{l.innerHTML="Erreur lors de la localisation du chantier."}})})();
