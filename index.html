<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>JMAGEO - Estimation intervention</title>

<style>
:root {
    --primary: #a84c30;
    --secondary: #6d6e71;
    --bg: #f7f7f7;
}

/* RESET */
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: var(--bg);
    color: #333;
}

/* HEADER */
header {
    background: white;
    text-align: center;
    padding: 20px 15px;
    border-bottom: 3px solid var(--primary);
}

header img {
    width: 100%;
    max-width: 180px;
    height: auto;
    margin-bottom: 10px;
}

header h1 {
    font-size: clamp(18px, 4vw, 22px);
    margin: 0;
    color: var(--primary);
}

header p {
    margin-top: 5px;
    font-size: clamp(13px, 3.5vw, 15px);
    color: var(--secondary);
}

/* CONTENU */
main {
    max-width: 720px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 6px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}

/* FORMULAIRE */
label {
    display: block;
    margin-top: 18px;
    font-weight: bold;
    color: var(--secondary);
    font-size: 14px;
}

input, select {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

button {
    margin-top: 25px;
    width: 100%;
    padding: 14px;
    background: var(--primary);
    color: white;
    font-size: 16px;
    font-weight: bold;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background: #8f3f27;
}

/* RESULTAT */
#resultat {
    margin-top: 25px;
    padding: 15px;
    background: #fafafa;
    border-left: 5px solid var(--primary);
    font-size: 15px;
}

/* FOOTER */
footer {
    margin-top: 25px;
    font-size: 13px;
    color: var(--secondary);
    text-align: center;
    line-height: 1.6;
}

footer a {
    color: var(--primary);
    text-decoration: none;
    font-weight: bold;
}

/* TABLETTE & DESKTOP */
@media (min-width: 768px) {
    main {
        padding: 30px;
    }

    label {
        font-size: 15px;
    }

    input, select {
        font-size: 16px;
    }

    #resultat {
        font-size: 16px;
    }
}
</style>
</head>

<body>

<header>
    <img src="logo-jmageo.png" alt="JMAGEO">
    <h1>JMAGEO - Estimez le coût de notre intervention</h1>
    <p>Implantation des axes gros-œuvre de bâtiments</p>
</header>

<main>

    <label>Adresse ou ville du chantier (France)</label>
    <input type="text" id="adresse" placeholder="Ex : 5 rue Victor Hugo, Reims">

    <label>
        Sélectionnez dans la liste le type d'implantation
        ("implantation initiale" ou "report des axes sur VPP")
    </label>
    <select id="type">
        <option value="A">Implantation initiale des axes gros-œuvre de bâtiments</option>
        <option value="B">
            Report des axes gros-œuvre de l'implantation initiale
            sur voiles-par-passes ou voiles-contre-terre
        </option>
    </select>

    <label>Nombre d’axes à implanter</label>
    <input type="number" id="n" min="1" value="1">

    <button onclick="calculer()">Calculer l’estimation</button>

    <div id="resultat"></div>

    <footer>
        Le prix est estimatif et correspond à un déplacement sur le terrain.
        Si besoin, veuillez nous écrire à :
        <a href="mailto:contact@jmageo.com">contact@jmageo.com</a>
        – Notre site Web
        <a href="https://www.jmageo.com" target="_blank">www.jmageo.com</a><br>
        <strong>Merci pour votre confiance!</strong>
    </footer>

</main>

<script>
// Adresse JMAGEO
const JMAGEO_LAT = 48.5701;
const JMAGEO_LON = 2.6324;

// Distance Haversine
function haversine(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;
    return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// Géocodage Nominatim
async function geocode(adresse) {
    const url =
        "https://nominatim.openstreetmap.org/search?format=json&q=" +
        encodeURIComponent(adresse) +
        "&countrycodes=fr";

    const response = await fetch(url);
    const data = await response.json();

    if (!data.length) throw "Adresse introuvable";

    return { lat: +data[0].lat, lon: +data[0].lon };
}

async function calculer() {
    const adresse = document.getElementById("adresse").value;
    const type = document.getElementById("type").value;
    const n = parseInt(document.getElementById("n").value);
    const resultat = document.getElementById("resultat");

    if (!adresse || n <= 0) {
        resultat.innerHTML = "Veuillez saisir une adresse valide et un nombre d’axes.";
        return;
    }

    resultat.innerHTML = "Calcul en cours...";

    try {
        const chantier = await geocode(adresse);
        const Km =
            haversine(JMAGEO_LAT, JMAGEO_LON, chantier.lat, chantier.lon) * 1.30;

        let prix;
        if (type === "A") {
            prix = n <= 2 ? 800 + 3 * Km + 200 * n : 1000 + 3 * Km + 200 * n;
        } else {
            prix = n <= 2 ? 500 + 3 * Km + 100 * n : 800 + 3 * Km + 110 * n;
        }

        resultat.innerHTML =
            "Distance estimée : <strong>" + Km.toFixed(1) + " km</strong><br>" +
            "Prix estimatif : <strong>" + prix.toFixed(0) + " € HT</strong>";
    } catch {
        resultat.innerHTML = "Erreur lors de la localisation du chantier.";
    }
}
</script>

</body>
</html>
